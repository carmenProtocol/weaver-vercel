# Текущий контекст проекта Weaver

## Структура проекта
- `config.py` - конфигурация с параметрами стратегии (комиссии, границы, распределение средств)
- `state.py` - управление состоянием стратегии (балансы, позиции, хеджи)
- `strategy.py` - торговая логика (инициализация, расчет хеджей, управление позициями)
- `executor.py` - исполнение ордеров на бирже OKX
- `analyzer.py` - расчет P&L и метрик
- `data_fetcher.py` - получение данных с биржи (цены, балансы)
- `main.py` - основной цикл работы бота
- `.env` - конфигурация API ключей

## Текущее состояние
1. Реализована базовая логика торговой стратегии:
   - Распределение депозита: 75% спот / 25% хеджи
   - Спот позиция: 50% в ETH / 50% в USDT
   - Хедж уровни: -2%, -4%, -6% от цены входа
   - Размеры хеджей: 20%, 30%, 50% от максимального убытка

2. Настроено подключение к бирже OKX:
   - Используется тестовая сеть (TESTNET=true)
   - Реализовано получение балансов и цен
   - Настроено исполнение ордеров

3. Последние изменения:
   - Исправлено получение API ключей из .env файла
   - Добавлена начальная покупка ETH при старте
   - Реализовано получение реального баланса как начального депозита

4. Текущие проблемы:
   - Необходимо протестировать начальную покупку ETH
   - Проверить расчет размеров хедж-позиций
   - Протестировать работу в тестовой сети OKX

## Следующие шаги
1. Протестировать начальную покупку ETH (должно быть 37.5% от депозита)
2. Проверить работу хедж-уровней
3. Добавить логирование всех операций
4. Реализовать сохранение состояния между перезапусками

## Конфигурация
```python
# Основные параметры стратегии
SPOT_ALLOCATION = 0.75   # 75% на спот
HEDGE_ALLOCATION = 0.25  # 25% на хедж
UPPER_BOUND_MULT = 1.06  # +6%
LOWER_BOUND_MULT = 0.94  # -6%
BUFFER_MULT = 0.92      # -8%
```

## Текущие метрики
```
Цена ETH: $3614.01
ETH баланс: 0.000000 ETH ($0.00)
USDT баланс: $1000.71
Общая стоимость: $1000.71
Total P&L: $0.0
Spot P&L: $0.0
Hedge P&L: $0
Commission: $0.0
Funding Cost: $0
ROE: 0.0%
```

## API ключи
Используются тестовые API ключи для OKX Demo Trading:
```
OKX_API_KEY=e31c7bc8-3194-4164-a520-d6a6cf04636d
OKX_SECRET_KEY=FCBC3C997EEA320780A64F98158C35C8
OKX_PASSWORD=Nestor1994!
TESTNET=true
``` 